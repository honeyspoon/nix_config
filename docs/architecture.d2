# Nix Configuration Architecture
# Generated programmatically - run `d2 docs/architecture.d2 docs/architecture.svg`

direction: right

title: |md
  # Nix Configuration Architecture
  Abder's cross-platform (macOS + Linux) Nix setup
| {
  near: top-center
}

# Entry point
flake: flake.nix {
  shape: document
  style.fill: "#1a1b26"
  style.font-color: "#a9b1d6"
}

# Flake Inputs
inputs: Flake Inputs {
  style.fill: "#24283b"
  style.font-color: "#7aa2f7"

  nixpkgs: nixpkgs-25.11
  nix-darwin
  home-manager
  sops-nix
  rust-overlay
  stylix
  zen-browser
  git-hooks
  treefmt-nix
  nix-index-db
}

# Platform Configurations
darwin-config: darwinConfigurations {
  style.fill: "#24283b"
  style.font-color: "#f7768e"
  workmbp: workmbp\n(aarch64-darwin)
}

home-config: homeConfigurations {
  style.fill: "#24283b"
  style.font-color: "#bb9af7"
  linux: abder@linux\n(x86_64)
  linux-arm: abder@linux-arm\n(aarch64)
}

# Darwin Modules
darwin-mods: Darwin Modules {
  style.fill: "#1a1b26"
  style.font-color: "#f7768e"

  configuration
  homebrew
  macos-defaults
  cronjobs
  packages
  nix
}

# Home Manager Modules
hm-mods: Home Manager Modules {
  style.fill: "#1a1b26"
  style.font-color: "#9ece6a"

  core: Core\nhome/core/packages/programs
  shells: Shells\nzsh/shell/terminal
  dev: Development\ngit/neovim/lspmux
  ai: AI Tools\nclaude/opencode/skills
  theme: Theming\nstylix/zen-browser
  system: System\nsecrets/ssh/cronjobs
}

# Packages & Checks
outputs: Outputs {
  style.fill: "#24283b"
  style.font-color: "#e0af68"

  packages: Packages\nagent-browser/nvim-lazyvim
  checks: Checks\npre-commit/formatting
  devShell: devShell\nnix tools
}

# Connections
flake -> inputs: imports
flake -> darwin-config: defines
flake -> home-config: defines
flake -> outputs: exports

inputs -> darwin-config: provides
inputs -> home-config: provides

darwin-config -> darwin-mods: loads
home-config -> hm-mods: loads
